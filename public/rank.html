<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Register page</title>
        <link rel="stylesheet" href="rank.css">

        <!-- update the version number as needed -->
        <script defer src="/__/firebase/5.9.4/firebase-app.js"></script>
        <!-- include only the Firebase features as you need -->
        <script defer src="/__/firebase/5.9.4/firebase-auth.js"></script>
        <script defer src="/__/firebase/5.9.4/firebase-firestore.js"></script>
        <!-- initialize the SDK after all desired features are loaded -->
        <script defer src="/__/firebase/init.js"></script>

    </head>
    <body>
        <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyA2F_Oj3ypKS79MPsP0T7RHmmLmLSuCHUY",
                authDomain: "cs252-lab6-e8bb1.firebaseapp.com",
                databaseURL: "https://cs252-lab6-e8bb1.firebaseio.com",
                projectId: "cs252-lab6-e8bb1",
                storageBucket: "cs252-lab6-e8bb1.appspot.com",
                messagingSenderId: "798850310478"
            };
            firebase.initializeApp(config);
        </script>

    <script>
        firebase.auth().onAuthStateChanged(function(user) {
            const linkRegister = document.getElementById('linkRegister');
            const linkSignin = document.getElementById('linkSignin');
            const userName = document.getElementById('userName');
            if(user) {
                console.log(user);
                userName.style.display = "block";
                linkSignin.style.display = "none";
                linkRegister.style.display = "none";
            } else {
                console.log('not logged in');
                userName.style.display = "none";
                linkSignin.style.display = "block";
                linkRegister.style.display = "block";
            }
        });
        </script>
      
        <div class="top">
            <div class="t_l">
                <a href="index.html">
                    Home
                </a>
            </div>
            
            <div class="t_r">
                <div>
                    <a id="linkRegister" href="register.html">
                        register
                    </a>
                </div>
                <div>
                    <a id="linkSignin" href="register.html">
                        signin
                    </a>
                </div>
                <div>
                    <a id="userName" href="">
                        <script>
                            var name;
                            firebase.auth().onAuthStateChanged(function(user) {
                                if(user != null) {  
                                    var userName = user.displayName;                        
                                        if(userName) {
                                    name = userName;
                                } else {
                                    name = "Anonymous";
                                }
                            }
                            });
                            document.write(`Welcome ${name}`);
                        </script>
                    </a>
                </div>
            </div>
        </div>
      
        <div class="con">
            <div class="msg">
                <div class="msg_name">
                    <p id="myUsername"></p>
                    <script>
                        firebase.auth().onAuthStateChanged(function(user) {
                            if(user != null) {  
                                var userName = user.displayName; 
                                document.getElementById("myUsername").innerHTML = `Username: ${userName}`;                      
                            }
                        });
                    </script>
                </div>
                <div class="msg_score">
                    <p id="myScore"></p>
                    <script>
                        firebase.auth().onAuthStateChanged(function(user) {
                            if(user != null) { 
                                const db = firebase.firestore();
                                var docRef = db.collection("users").doc(user.uid); 
                                docRef.get().then(function(doc) {
                                    if (doc.exists) {
                                        document.getElementById("myScore").innerHTML = `Score: ${doc.data().maxscore}`;
                                        console.log("Document data:", doc.data());
                                    } else {
                                        console.log("No such document!");
                                    }
                                }).catch(function(error) {
                                    console.log("Error getting document:", error);
                                });                       
                            }
                        });
                    </script>
                </div>
            </div>
        </div>
        <table>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Score</th>
            </tr>
            <script defer src="rank.js"></script>
            <tr>
                <td>1</td>
                <td id="firstName">
                </td>
                <td id="firstScore">
                </td>
            </tr>
            <tr>
                <td>2</td>
                <td id="secondName">
                </td>
                <td id="secondScore">
                </td>
            </tr>
            <tr>
                <td>3</td>
                <td id="thirdName">
                </td>
                <td id="thirdScore">
                </td>
            </tr>
            <tr>
                <td>4</td>
                <td id="fourthName">
                </td>
                <td id="fourthScore">
                </td>
            </tr>
            <tr>
                <td>5</td>
                <td id="fifthName">
                </td>
                <td id="fifthScore">
                </td>
            </tr>
        </table>
    </body>
</html>